import { __decorate, __param } from "tslib";
import Swiper from 'swiper';
import { PLATFORM_ID } from '@angular/core';
import { isPlatformBrowser } from '@angular/common';
import { NgZone, Inject, Optional, ElementRef, Directive, AfterViewInit, OnDestroy, DoCheck, OnChanges, Input, Output, EventEmitter, SimpleChanges, KeyValueDiffer, KeyValueDiffers } from '@angular/core';
import { SWIPER_CONFIG, SwiperConfig, SwiperEvents } from './swiper.interfaces';
let SwiperDirective = class SwiperDirective {
    constructor(platformId, zone, elementRef, differs, defaults) {
        this.platformId = platformId;
        this.zone = zone;
        this.elementRef = elementRef;
        this.differs = differs;
        this.defaults = defaults;
        this.initialIndex = null;
        this.configDiff = null;
        this.disabled = false;
        this.performance = false;
        this.indexChange = new EventEmitter();
        this.S_INIT = new EventEmitter();
        this.S_BEFOREDESTROY = new EventEmitter();
        this.S_SCROLL = new EventEmitter();
        this.S_PROGRESS = new EventEmitter();
        this.S_KEYPRESS = new EventEmitter();
        this.S_RESIZE = new EventEmitter();
        this.S_BREAKPOINT = new EventEmitter();
        this.S_ZOOMCHANGE = new EventEmitter();
        this.S_AFTERRESIZE = new EventEmitter();
        this.S_BEFORERESIZE = new EventEmitter();
        this.S_LOOPFIX = new EventEmitter();
        this.S_BEFORELOOPFIX = new EventEmitter();
        this.S_SLIDERMOVE = new EventEmitter();
        this.S_SLIDECHANGE = new EventEmitter();
        this.S_SETTRANSLATE = new EventEmitter();
        this.S_SETTRANSITION = new EventEmitter();
        this.S_FROMEDGE = new EventEmitter();
        this.S_REACHEND = new EventEmitter();
        this.S_REACHBEGINNING = new EventEmitter();
        this.S_AUTOPLAY = new EventEmitter();
        this.S_AUTOPLAYSTART = new EventEmitter();
        this.S_AUTOPLAYSTOP = new EventEmitter();
        this.S_IMAGESREADY = new EventEmitter();
        this.S_LAZYIMAGELOAD = new EventEmitter();
        this.S_LAZYIMAGEREADY = new EventEmitter();
        this.S_SCROLLDRAGEND = new EventEmitter();
        this.S_SCROLLDRAGMOVE = new EventEmitter();
        this.S_SCROLLDRAGSTART = new EventEmitter();
        this.S_NAVIGATIONHIDE = new EventEmitter();
        this.S_NAVIGATIONSHOW = new EventEmitter();
        this.S_PAGINATIONRENDER = new EventEmitter();
        this.S_PAGINATIONUPDATE = new EventEmitter();
        this.S_PAGINATIONHIDE = new EventEmitter();
        this.S_PAGINATIONSHOW = new EventEmitter();
        this.S_TAP = new EventEmitter();
        this.S_CLICK = new EventEmitter();
        this.S_DOUBLETAP = new EventEmitter();
        this.S_TOUCHEND = new EventEmitter();
        this.S_TOUCHMOVE = new EventEmitter();
        this.S_TOUCHSTART = new EventEmitter();
        this.S_TOUCHMOVEOPPOSITE = new EventEmitter();
        this.S_TRANSITIONEND = new EventEmitter();
        this.S_TRANSITIONSTART = new EventEmitter();
        this.S_SLIDEPREVTRANSITIONEND = new EventEmitter();
        this.S_SLIDEPREVTRANSITIONSTART = new EventEmitter();
        this.S_SLIDENEXTTRANSITIONEND = new EventEmitter();
        this.S_SLIDENEXTTRANSITIONSTART = new EventEmitter();
        this.S_SLIDECHANGETRANSITIONEND = new EventEmitter();
        this.S_SLIDECHANGETRANSITIONSTART = new EventEmitter();
    }
    set index(index) {
        if (index != null) {
            this.setIndex(index);
        }
    }
    ngAfterViewInit() {
        if (!isPlatformBrowser(this.platformId)) {
            return;
        }
        const params = new SwiperConfig(this.defaults);
        params.assign(this.config); // Custom configuration
        if (params.scrollbar === true) {
            params.scrollbar = {
                el: '.swiper-scrollbar'
            };
        }
        if (params.pagination === true) {
            params.pagination = {
                el: '.swiper-pagination'
            };
        }
        if (params.navigation === true) {
            params.navigation = {
                prevEl: '.swiper-button-prev',
                nextEl: '.swiper-button-next'
            };
        }
        if (this.disabled) {
            params.allowSlidePrev = false;
            params.allowSlideNext = false;
        }
        if (this.initialIndex != null) {
            params.initialSlide = this.initialIndex;
            this.initialIndex = null;
        }
        params.on = {
            slideChange: () => {
                if (this.instance && this.indexChange.observers.length) {
                    this.emit(this.indexChange, this.instance.realIndex);
                }
            }
        };
        this.zone.runOutsideAngular(() => {
            this.instance = new Swiper(this.elementRef.nativeElement, params);
        });
        if (params.init !== false && this.S_INIT.observers.length) {
            this.emit(this.S_INIT, this.instance);
        }
        // Add native Swiper event handling
        SwiperEvents.forEach((eventName) => {
            let swiperEvent = eventName.replace('swiper', '');
            swiperEvent = swiperEvent.charAt(0).toLowerCase() + swiperEvent.slice(1);
            this.instance.on(swiperEvent, (...args) => {
                if (args.length === 1) {
                    args = args[0];
                }
                const output = `S_${swiperEvent.toUpperCase()}`;
                const emitter = this[output];
                if (emitter.observers.length) {
                    this.emit(emitter, args);
                }
            });
        });
        if (!this.configDiff) {
            this.configDiff = this.differs.find(this.config || {}).create();
            this.configDiff.diff(this.config || {});
        }
    }
    ngOnDestroy() {
        if (this.instance) {
            this.zone.runOutsideAngular(() => {
                this.instance.destroy(true, this.instance.initialized || false);
            });
            this.instance = null;
        }
    }
    ngDoCheck() {
        if (this.configDiff) {
            const changes = this.configDiff.diff(this.config || {});
            if (changes) {
                this.initialIndex = this.getIndex(true);
                this.ngOnDestroy();
                this.ngAfterViewInit();
                this.update();
            }
        }
    }
    ngOnChanges(changes) {
        if (this.instance && changes['disabled']) {
            if (changes['disabled'].currentValue !== changes['disabled'].previousValue) {
                if (changes['disabled'].currentValue === true) {
                    this.zone.runOutsideAngular(() => {
                        this.ngOnDestroy();
                        this.ngAfterViewInit();
                    });
                }
                else if (changes['disabled'].currentValue === false) {
                    this.zone.runOutsideAngular(() => {
                        this.ngOnDestroy();
                        this.ngAfterViewInit();
                    });
                }
            }
        }
    }
    emit(emitter, value) {
        if (this.performance) {
            emitter.emit(value);
        }
        else {
            this.zone.run(() => emitter.emit(value));
        }
    }
    swiper() {
        return this.instance;
    }
    init() {
        if (this.instance) {
            this.zone.runOutsideAngular(() => {
                this.instance.init();
            });
        }
    }
    update() {
        setTimeout(() => {
            if (this.instance) {
                this.zone.runOutsideAngular(() => {
                    this.instance.update();
                });
            }
        }, 0);
    }
    getIndex(real) {
        if (!this.instance) {
            return this.initialIndex || 0;
        }
        else {
            return real ? this.instance.realIndex : this.instance.activeIndex;
        }
    }
    setIndex(index, speed, silent) {
        if (!this.instance) {
            this.initialIndex = index;
        }
        else {
            let realIndex = index * this.instance.params.slidesPerGroup;
            if (this.instance.params.loop) {
                realIndex += this.instance.loopedSlides;
            }
            this.zone.runOutsideAngular(() => {
                this.instance.slideTo(realIndex, speed, !silent);
            });
        }
    }
    prevSlide(speed, silent) {
        if (this.instance) {
            this.zone.runOutsideAngular(() => {
                this.instance.slidePrev(speed, !silent);
            });
        }
    }
    nextSlide(speed, silent) {
        if (this.instance) {
            this.zone.runOutsideAngular(() => {
                this.instance.slideNext(speed, !silent);
            });
        }
    }
    stopAutoplay(reset) {
        if (reset) {
            this.setIndex(0);
        }
        if (this.instance && this.instance.autoplay) {
            this.zone.runOutsideAngular(() => {
                this.instance.autoplay.stop();
            });
        }
    }
    startAutoplay(reset) {
        if (reset) {
            this.setIndex(0);
        }
        if (this.instance && this.instance.autoplay) {
            this.zone.runOutsideAngular(() => {
                this.instance.autoplay.start();
            });
        }
    }
};
SwiperDirective.ctorParameters = () => [
    { type: Object, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] },
    { type: NgZone },
    { type: ElementRef },
    { type: KeyValueDiffers },
    { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [SWIPER_CONFIG,] }] }
];
__decorate([
    Input()
], SwiperDirective.prototype, "index", null);
__decorate([
    Input()
], SwiperDirective.prototype, "disabled", void 0);
__decorate([
    Input()
], SwiperDirective.prototype, "performance", void 0);
__decorate([
    Input('swiper')
], SwiperDirective.prototype, "config", void 0);
__decorate([
    Output()
], SwiperDirective.prototype, "indexChange", void 0);
__decorate([
    Output('init')
], SwiperDirective.prototype, "S_INIT", void 0);
__decorate([
    Output('beforeDestroy')
], SwiperDirective.prototype, "S_BEFOREDESTROY", void 0);
__decorate([
    Output('scroll')
], SwiperDirective.prototype, "S_SCROLL", void 0);
__decorate([
    Output('progress')
], SwiperDirective.prototype, "S_PROGRESS", void 0);
__decorate([
    Output('keyPress')
], SwiperDirective.prototype, "S_KEYPRESS", void 0);
__decorate([
    Output('resize')
], SwiperDirective.prototype, "S_RESIZE", void 0);
__decorate([
    Output('breakpoint')
], SwiperDirective.prototype, "S_BREAKPOINT", void 0);
__decorate([
    Output('zoomChange')
], SwiperDirective.prototype, "S_ZOOMCHANGE", void 0);
__decorate([
    Output('afterResize')
], SwiperDirective.prototype, "S_AFTERRESIZE", void 0);
__decorate([
    Output('beforeResize')
], SwiperDirective.prototype, "S_BEFORERESIZE", void 0);
__decorate([
    Output('loopFix')
], SwiperDirective.prototype, "S_LOOPFIX", void 0);
__decorate([
    Output('beforeLoopFix')
], SwiperDirective.prototype, "S_BEFORELOOPFIX", void 0);
__decorate([
    Output('sliderMove')
], SwiperDirective.prototype, "S_SLIDERMOVE", void 0);
__decorate([
    Output('slideChange')
], SwiperDirective.prototype, "S_SLIDECHANGE", void 0);
__decorate([
    Output('setTranslate')
], SwiperDirective.prototype, "S_SETTRANSLATE", void 0);
__decorate([
    Output('setTransition')
], SwiperDirective.prototype, "S_SETTRANSITION", void 0);
__decorate([
    Output('fromEdge')
], SwiperDirective.prototype, "S_FROMEDGE", void 0);
__decorate([
    Output('reachEnd')
], SwiperDirective.prototype, "S_REACHEND", void 0);
__decorate([
    Output('reachBeginning')
], SwiperDirective.prototype, "S_REACHBEGINNING", void 0);
__decorate([
    Output('autoplay')
], SwiperDirective.prototype, "S_AUTOPLAY", void 0);
__decorate([
    Output('autoplayStart')
], SwiperDirective.prototype, "S_AUTOPLAYSTART", void 0);
__decorate([
    Output('autoplayStop')
], SwiperDirective.prototype, "S_AUTOPLAYSTOP", void 0);
__decorate([
    Output('imagesReady')
], SwiperDirective.prototype, "S_IMAGESREADY", void 0);
__decorate([
    Output('lazyImageLoad')
], SwiperDirective.prototype, "S_LAZYIMAGELOAD", void 0);
__decorate([
    Output('lazyImageReady')
], SwiperDirective.prototype, "S_LAZYIMAGEREADY", void 0);
__decorate([
    Output('scrollDragEnd')
], SwiperDirective.prototype, "S_SCROLLDRAGEND", void 0);
__decorate([
    Output('scrollDragMove')
], SwiperDirective.prototype, "S_SCROLLDRAGMOVE", void 0);
__decorate([
    Output('scrollDragStart')
], SwiperDirective.prototype, "S_SCROLLDRAGSTART", void 0);
__decorate([
    Output('navigationHide')
], SwiperDirective.prototype, "S_NAVIGATIONHIDE", void 0);
__decorate([
    Output('navigationShow')
], SwiperDirective.prototype, "S_NAVIGATIONSHOW", void 0);
__decorate([
    Output('paginationRender')
], SwiperDirective.prototype, "S_PAGINATIONRENDER", void 0);
__decorate([
    Output('paginationUpdate')
], SwiperDirective.prototype, "S_PAGINATIONUPDATE", void 0);
__decorate([
    Output('paginationHide')
], SwiperDirective.prototype, "S_PAGINATIONHIDE", void 0);
__decorate([
    Output('paginationShow')
], SwiperDirective.prototype, "S_PAGINATIONSHOW", void 0);
__decorate([
    Output('swiperTap')
], SwiperDirective.prototype, "S_TAP", void 0);
__decorate([
    Output('swiperClick')
], SwiperDirective.prototype, "S_CLICK", void 0);
__decorate([
    Output('swiperDoubleTap')
], SwiperDirective.prototype, "S_DOUBLETAP", void 0);
__decorate([
    Output('swiperTouchEnd')
], SwiperDirective.prototype, "S_TOUCHEND", void 0);
__decorate([
    Output('swiperTouchMove')
], SwiperDirective.prototype, "S_TOUCHMOVE", void 0);
__decorate([
    Output('swiperTouchStart')
], SwiperDirective.prototype, "S_TOUCHSTART", void 0);
__decorate([
    Output('swiperTouchMoveOpposite')
], SwiperDirective.prototype, "S_TOUCHMOVEOPPOSITE", void 0);
__decorate([
    Output('swiperTransitionEnd')
], SwiperDirective.prototype, "S_TRANSITIONEND", void 0);
__decorate([
    Output('swiperTransitionStart')
], SwiperDirective.prototype, "S_TRANSITIONSTART", void 0);
__decorate([
    Output('slidePrevTransitionEnd')
], SwiperDirective.prototype, "S_SLIDEPREVTRANSITIONEND", void 0);
__decorate([
    Output('slidePrevTransitionStart')
], SwiperDirective.prototype, "S_SLIDEPREVTRANSITIONSTART", void 0);
__decorate([
    Output('slideNextTransitionEnd')
], SwiperDirective.prototype, "S_SLIDENEXTTRANSITIONEND", void 0);
__decorate([
    Output('slideNextTransitionStart')
], SwiperDirective.prototype, "S_SLIDENEXTTRANSITIONSTART", void 0);
__decorate([
    Output('slideChangeTransitionEnd')
], SwiperDirective.prototype, "S_SLIDECHANGETRANSITIONEND", void 0);
__decorate([
    Output('slideChangeTransitionStart')
], SwiperDirective.prototype, "S_SLIDECHANGETRANSITIONSTART", void 0);
SwiperDirective = __decorate([
    Directive({
        selector: '[swiper]',
        exportAs: 'ngxSwiper'
    }),
    __param(0, Inject(PLATFORM_ID)),
    __param(4, Optional()), __param(4, Inject(SWIPER_CONFIG))
], SwiperDirective);
export { SwiperDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3dpcGVyLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1zd2lwZXItd3JhcHBlci8iLCJzb3VyY2VzIjpbImxpYi9zd2lwZXIuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLE1BQU0sTUFBTSxRQUFRLENBQUM7QUFFNUIsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM1QyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFDdEQsYUFBYSxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUN6RSxhQUFhLEVBQUUsY0FBYyxFQUFFLGVBQWUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV4RSxPQUFPLEVBQUUsYUFBYSxFQUFFLFlBQVksRUFDckIsWUFBWSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFNekQsSUFBYSxlQUFlLEdBQTVCLE1BQWEsZUFBZTtJQXFGMUIsWUFBeUMsVUFBa0IsRUFBVSxJQUFZLEVBQ3ZFLFVBQXNCLEVBQVUsT0FBd0IsRUFDckIsUUFBK0I7UUFGbkMsZUFBVSxHQUFWLFVBQVUsQ0FBUTtRQUFVLFNBQUksR0FBSixJQUFJLENBQVE7UUFDdkUsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUFVLFlBQU8sR0FBUCxPQUFPLENBQWlCO1FBQ3JCLGFBQVEsR0FBUixRQUFRLENBQXVCO1FBcEZwRSxpQkFBWSxHQUFrQixJQUFJLENBQUM7UUFFbkMsZUFBVSxHQUF1QyxJQUFJLENBQUM7UUFTckQsYUFBUSxHQUFZLEtBQUssQ0FBQztRQUUxQixnQkFBVyxHQUFZLEtBQUssQ0FBQztRQUk1QixnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFVLENBQUM7UUFFWixXQUFNLEdBQTZCLElBQUks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QUNULFFBQVEsRUFBRSxVQUFVO1FBQ3BCLFFBQVEsRUFBRSxXQUFXO0tBQ3RCLENBQUM7SUFzRmEsV0FBQSxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUE7SUFFN0IsV0FBQSxRQUFRLEVBQUUsQ0FBQSxFQUFFLFdBQUEsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFBO0dBdkZ6QixlQUFlLENBdVQzQjtTQXZUWSxlQUFlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFN3aXBlciBmcm9tICdzd2lwZXInO1xuXG5pbXBvcnQgeyBQTEFURk9STV9JRCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgaXNQbGF0Zm9ybUJyb3dzZXIgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgTmdab25lLCBJbmplY3QsIE9wdGlvbmFsLCBFbGVtZW50UmVmLCBEaXJlY3RpdmUsXG4gIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSwgRG9DaGVjaywgT25DaGFuZ2VzLCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsXG4gIFNpbXBsZUNoYW5nZXMsIEtleVZhbHVlRGlmZmVyLCBLZXlWYWx1ZURpZmZlcnMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgU1dJUEVSX0NPTkZJRywgU3dpcGVyQ29uZmlnLCBTd2lwZXJDb25maWdJbnRlcmZhY2UsXG4gIFN3aXBlckV2ZW50LCBTd2lwZXJFdmVudHMgfSBmcm9tICcuL3N3aXBlci5pbnRlcmZhY2VzJztcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW3N3aXBlcl0nLFxuICBleHBvcnRBczogJ25neFN3aXBlcidcbn0pXG5leHBvcnQgY2xhc3MgU3dpcGVyRGlyZWN0aXZlIGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95LCBEb0NoZWNrLCBPbkNoYW5nZXMge1xuICBwcml2YXRlIGluc3RhbmNlOiBhbnk7XG5cbiAgcHJpdmF0ZSBpbml0aWFsSW5kZXg6IG51bWJlciB8IG51bGwgPSBudWxsO1xuXG4gIHByaXZhdGUgY29uZmlnRGlmZjogS2V5VmFsdWVEaWZmZXI8c3RyaW5nLCBhbnk+IHwgbnVsbCA9IG51bGw7XG5cbiAgQElucHV0KClcbiAgc2V0IGluZGV4KGluZGV4OiBudW1iZXIpIHtcbiAgICBpZiAoaW5kZXggIT0gbnVsbCkge1xuICAgICAgdGhpcy5zZXRJbmRleChpbmRleCk7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KCkgZGlzYWJsZWQ6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBASW5wdXQoKSBwZXJmb3JtYW5jZTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIEBJbnB1dCgnc3dpcGVyJykgY29uZmlnPzogU3dpcGVyQ29uZmlnSW50ZXJmYWNlO1xuXG4gIEBPdXRwdXQoKSBpbmRleENoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8bnVtYmVyPigpO1xuXG4gIEBPdXRwdXQoJ2luaXQnICAgICAgICAgICAgICAgICAgICAgICApIFNfSU5JVCAgICAgICAgICAgICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ2JlZm9yZURlc3Ryb3knICAgICAgICAgICAgICApIFNfQkVGT1JFREVTVFJPWSAgICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgQE91dHB1dCgnc2Nyb2xsJyAgICAgICAgICAgICAgICAgICAgICkgU19TQ1JPTEwgICAgICAgICAgICAgICAgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgncHJvZ3Jlc3MnICAgICAgICAgICAgICAgICAgICkgU19QUk9HUkVTUyAgICAgICAgICAgICAgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgna2V5UHJlc3MnICAgICAgICAgICAgICAgICAgICkgU19LRVlQUkVTUyAgICAgICAgICAgICAgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBAT3V0cHV0KCdyZXNpemUnICAgICAgICAgICAgICAgICAgICAgKSBTX1JFU0laRSAgICAgICAgICAgICAgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCdicmVha3BvaW50JyAgICAgICAgICAgICAgICAgKSBTX0JSRUFLUE9JTlQgICAgICAgICAgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCd6b29tQ2hhbmdlJyAgICAgICAgICAgICAgICAgKSBTX1pPT01DSEFOR0UgICAgICAgICAgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCdhZnRlclJlc2l6ZScgICAgICAgICAgICAgICAgKSBTX0FGVEVSUkVTSVpFICAgICAgICAgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCdiZWZvcmVSZXNpemUnICAgICAgICAgICAgICAgKSBTX0JFRk9SRVJFU0laRSAgICAgICAgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIEBPdXRwdXQoJ2xvb3BGaXgnICAgICAgICAgICAgICAgICAgICApIFNfTE9PUEZJWCAgICAgICAgICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ2JlZm9yZUxvb3BGaXgnICAgICAgICAgICAgICApIFNfQkVGT1JFTE9PUEZJWCAgICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgQE91dHB1dCgnc2xpZGVyTW92ZScgICAgICAgICAgICAgICAgICkgU19TTElERVJNT1ZFICAgICAgICAgICAgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgnc2xpZGVDaGFuZ2UnICAgICAgICAgICAgICAgICkgU19TTElERUNIQU5HRSAgICAgICAgICAgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBAT3V0cHV0KCdzZXRUcmFuc2xhdGUnICAgICAgICAgICAgICAgKSBTX1NFVFRSQU5TTEFURSAgICAgICAgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCdzZXRUcmFuc2l0aW9uJyAgICAgICAgICAgICAgKSBTX1NFVFRSQU5TSVRJT04gICAgICAgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIEBPdXRwdXQoJ2Zyb21FZGdlJyAgICAgICAgICAgICAgICAgICApIFNfRlJPTUVER0UgICAgICAgICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ3JlYWNoRW5kJyAgICAgICAgICAgICAgICAgICApIFNfUkVBQ0hFTkQgICAgICAgICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ3JlYWNoQmVnaW5uaW5nJyAgICAgICAgICAgICApIFNfUkVBQ0hCRUdJTk5JTkcgICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgQE91dHB1dCgnYXV0b3BsYXknICAgICAgICAgICAgICAgICAgICkgU19BVVRPUExBWSAgICAgICAgICAgICAgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgnYXV0b3BsYXlTdGFydCcgICAgICAgICAgICAgICkgU19BVVRPUExBWVNUQVJUICAgICAgICAgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgnYXV0b3BsYXlTdG9wJyAgICAgICAgICAgICAgICkgU19BVVRPUExBWVNUT1AgICAgICAgICAgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBAT3V0cHV0KCdpbWFnZXNSZWFkeScgICAgICAgICAgICAgICAgKSBTX0lNQUdFU1JFQURZICAgICAgICAgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCdsYXp5SW1hZ2VMb2FkJyAgICAgICAgICAgICAgKSBTX0xBWllJTUFHRUxPQUQgICAgICAgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCdsYXp5SW1hZ2VSZWFkeScgICAgICAgICAgICAgKSBTX0xBWllJTUFHRVJFQURZICAgICAgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIEBPdXRwdXQoJ3Njcm9sbERyYWdFbmQnICAgICAgICAgICAgICApIFNfU0NST0xMRFJBR0VORCAgICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ3Njcm9sbERyYWdNb3ZlJyAgICAgICAgICAgICApIFNfU0NST0xMRFJBR01PVkUgICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ3Njcm9sbERyYWdTdGFydCcgICAgICAgICAgICApIFNfU0NST0xMRFJBR1NUQVJUICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgQE91dHB1dCgnbmF2aWdhdGlvbkhpZGUnICAgICAgICAgICAgICkgU19OQVZJR0FUSU9OSElERSAgICAgICAgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgnbmF2aWdhdGlvblNob3cnICAgICAgICAgICAgICkgU19OQVZJR0FUSU9OU0hPVyAgICAgICAgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBAT3V0cHV0KCdwYWdpbmF0aW9uUmVuZGVyJyAgICAgICAgICAgKSBTX1BBR0lOQVRJT05SRU5ERVIgICAgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCdwYWdpbmF0aW9uVXBkYXRlJyAgICAgICAgICAgKSBTX1BBR0lOQVRJT05VUERBVEUgICAgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCdwYWdpbmF0aW9uSGlkZScgICAgICAgICAgICAgKSBTX1BBR0lOQVRJT05ISURFICAgICAgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCdwYWdpbmF0aW9uU2hvdycgICAgICAgICAgICAgKSBTX1BBR0lOQVRJT05TSE9XICAgICAgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIEBPdXRwdXQoJ3N3aXBlclRhcCcgICAgICAgICAgICAgICAgICApIFNfVEFQICAgICAgICAgICAgICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ3N3aXBlckNsaWNrJyAgICAgICAgICAgICAgICApIFNfQ0xJQ0sgICAgICAgICAgICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ3N3aXBlckRvdWJsZVRhcCcgICAgICAgICAgICApIFNfRE9VQkxFVEFQICAgICAgICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ3N3aXBlclRvdWNoRW5kJyAgICAgICAgICAgICApIFNfVE9VQ0hFTkQgICAgICAgICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ3N3aXBlclRvdWNoTW92ZScgICAgICAgICAgICApIFNfVE9VQ0hNT1ZFICAgICAgICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ3N3aXBlclRvdWNoU3RhcnQnICAgICAgICAgICApIFNfVE9VQ0hTVEFSVCAgICAgICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ3N3aXBlclRvdWNoTW92ZU9wcG9zaXRlJyAgICApIFNfVE9VQ0hNT1ZFT1BQT1NJVEUgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ3N3aXBlclRyYW5zaXRpb25FbmQnICAgICAgICApIFNfVFJBTlNJVElPTkVORCAgICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ3N3aXBlclRyYW5zaXRpb25TdGFydCcgICAgICApIFNfVFJBTlNJVElPTlNUQVJUICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgQE91dHB1dCgnc2xpZGVQcmV2VHJhbnNpdGlvbkVuZCcgICAgICkgU19TTElERVBSRVZUUkFOU0lUSU9ORU5EICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgnc2xpZGVQcmV2VHJhbnNpdGlvblN0YXJ0JyAgICkgU19TTElERVBSRVZUUkFOU0lUSU9OU1RBUlQgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgnc2xpZGVOZXh0VHJhbnNpdGlvbkVuZCcgICAgICkgU19TTElERU5FWFRUUkFOU0lUSU9ORU5EICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgnc2xpZGVOZXh0VHJhbnNpdGlvblN0YXJ0JyAgICkgU19TTElERU5FWFRUUkFOU0lUSU9OU1RBUlQgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgnc2xpZGVDaGFuZ2VUcmFuc2l0aW9uRW5kJyAgICkgU19TTElERUNIQU5HRVRSQU5TSVRJT05FTkQgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgnc2xpZGVDaGFuZ2VUcmFuc2l0aW9uU3RhcnQnICkgU19TTElERUNIQU5HRVRSQU5TSVRJT05TVEFSVCAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBjb25zdHJ1Y3RvcihASW5qZWN0KFBMQVRGT1JNX0lEKSBwcml2YXRlIHBsYXRmb3JtSWQ6IE9iamVjdCwgcHJpdmF0ZSB6b25lOiBOZ1pvbmUsXG4gICAgcHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmLCBwcml2YXRlIGRpZmZlcnM6IEtleVZhbHVlRGlmZmVycyxcbiAgICBAT3B0aW9uYWwoKSBASW5qZWN0KFNXSVBFUl9DT05GSUcpIHByaXZhdGUgZGVmYXVsdHM6IFN3aXBlckNvbmZpZ0ludGVyZmFjZSkge31cblxuICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XG4gICAgaWYgKCFpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtSWQpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgcGFyYW1zID0gbmV3IFN3aXBlckNvbmZpZyh0aGlzLmRlZmF1bHRzKTtcblxuICAgIHBhcmFtcy5hc3NpZ24odGhpcy5jb25maWcpOyAvLyBDdXN0b20gY29uZmlndXJhdGlvblxuXG4gICAgaWYgKHBhcmFtcy5zY3JvbGxiYXIgPT09IHRydWUpIHtcbiAgICAgIHBhcmFtcy5zY3JvbGxiYXIgPSB7XG4gICAgICAgIGVsOiAnLnN3aXBlci1zY3JvbGxiYXInXG4gICAgICB9O1xuICAgIH1cblxuICAgIGlmIChwYXJhbXMucGFnaW5hdGlvbiA9PT0gdHJ1ZSkge1xuICAgICAgcGFyYW1zLnBhZ2luYXRpb24gPSB7XG4gICAgICAgIGVsOiAnLnN3aXBlci1wYWdpbmF0aW9uJ1xuICAgICAgfTtcbiAgICB9XG5cbiAgICBpZiAocGFyYW1zLm5hdmlnYXRpb24gPT09IHRydWUpIHtcbiAgICAgIHBhcmFtcy5uYXZpZ2F0aW9uID0ge1xuICAgICAgICBwcmV2RWw6ICcuc3dpcGVyLWJ1dHRvbi1wcmV2JyxcbiAgICAgICAgbmV4dEVsOiAnLnN3aXBlci1idXR0b24tbmV4dCdcbiAgICAgIH07XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZGlzYWJsZWQpIHtcbiAgICAgIHBhcmFtcy5hbGxvd1NsaWRlUHJldiA9IGZhbHNlO1xuICAgICAgcGFyYW1zLmFsbG93U2xpZGVOZXh0ID0gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaW5pdGlhbEluZGV4ICE9IG51bGwpIHtcbiAgICAgIHBhcmFtcy5pbml0aWFsU2xpZGUgPSB0aGlzLmluaXRpYWxJbmRleDtcblxuICAgICAgdGhpcy5pbml0aWFsSW5kZXggPSBudWxsO1xuICAgIH1cblxuICAgIHBhcmFtcy5vbiA9IHtcbiAgICAgIHNsaWRlQ2hhbmdlOiAoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmluc3RhbmNlICYmIHRoaXMuaW5kZXhDaGFuZ2Uub2JzZXJ2ZXJzLmxlbmd0aCkge1xuICAgICAgICAgIHRoaXMuZW1pdCh0aGlzLmluZGV4Q2hhbmdlLCB0aGlzLmluc3RhbmNlLnJlYWxJbmRleCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy56b25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgIHRoaXMuaW5zdGFuY2UgPSBuZXcgU3dpcGVyKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCBwYXJhbXMpO1xuICAgIH0pO1xuXG4gICAgaWYgKHBhcmFtcy5pbml0ICE9PSBmYWxzZSAmJiB0aGlzLlNfSU5JVC5vYnNlcnZlcnMubGVuZ3RoKSB7XG4gICAgICB0aGlzLmVtaXQodGhpcy5TX0lOSVQsIHRoaXMuaW5zdGFuY2UpO1xuICAgIH1cblxuICAgIC8vIEFkZCBuYXRpdmUgU3dpcGVyIGV2ZW50IGhhbmRsaW5nXG4gICAgU3dpcGVyRXZlbnRzLmZvckVhY2goKGV2ZW50TmFtZTogU3dpcGVyRXZlbnQpID0+IHtcbiAgICAgIGxldCBzd2lwZXJFdmVudCA9IGV2ZW50TmFtZS5yZXBsYWNlKCdzd2lwZXInLCAnJyk7XG5cbiAgICAgIHN3aXBlckV2ZW50ID0gc3dpcGVyRXZlbnQuY2hhckF0KDApLnRvTG93ZXJDYXNlKCkgKyBzd2lwZXJFdmVudC5zbGljZSgxKTtcblxuICAgICAgdGhpcy5pbnN0YW5jZS5vbihzd2lwZXJFdmVudCwgKC4uLmFyZ3M6IGFueVtdKSA9PiB7XG4gICAgICAgIGlmIChhcmdzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgIGFyZ3MgPSBhcmdzWzBdO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgb3V0cHV0ID0gYFNfJHtzd2lwZXJFdmVudC50b1VwcGVyQ2FzZSgpfWA7XG5cbiAgICAgICAgY29uc3QgZW1pdHRlciA9IHRoaXNbb3V0cHV0IGFzIGtleW9mIFN3aXBlckRpcmVjdGl2ZV0gYXMgRXZlbnRFbWl0dGVyPGFueT47XG5cbiAgICAgICAgaWYgKGVtaXR0ZXIub2JzZXJ2ZXJzLmxlbmd0aCkge1xuICAgICAgICAgIHRoaXMuZW1pdChlbWl0dGVyLCBhcmdzKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpZiAoIXRoaXMuY29uZmlnRGlmZikge1xuICAgICAgdGhpcy5jb25maWdEaWZmID0gdGhpcy5kaWZmZXJzLmZpbmQodGhpcy5jb25maWcgfHwge30pLmNyZWF0ZSgpO1xuXG4gICAgICB0aGlzLmNvbmZpZ0RpZmYuZGlmZih0aGlzLmNvbmZpZyB8fCB7fSk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaW5zdGFuY2UpIHtcbiAgICAgIHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgIHRoaXMuaW5zdGFuY2UuZGVzdHJveSh0cnVlLCB0aGlzLmluc3RhbmNlLmluaXRpYWxpemVkIHx8wqBmYWxzZSk7XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5pbnN0YW5jZSA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgbmdEb0NoZWNrKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmNvbmZpZ0RpZmYpIHtcbiAgICAgIGNvbnN0IGNoYW5nZXMgPSB0aGlzLmNvbmZpZ0RpZmYuZGlmZih0aGlzLmNvbmZpZyB8fCB7fSk7XG5cbiAgICAgIGlmIChjaGFuZ2VzKSB7XG4gICAgICAgIHRoaXMuaW5pdGlhbEluZGV4ID0gdGhpcy5nZXRJbmRleCh0cnVlKTtcblxuICAgICAgICB0aGlzLm5nT25EZXN0cm95KCk7XG5cbiAgICAgICAgdGhpcy5uZ0FmdGVyVmlld0luaXQoKTtcblxuICAgICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5pbnN0YW5jZSAmJiBjaGFuZ2VzWydkaXNhYmxlZCddKSB7XG4gICAgICBpZiAoY2hhbmdlc1snZGlzYWJsZWQnXS5jdXJyZW50VmFsdWUgIT09IGNoYW5nZXNbJ2Rpc2FibGVkJ10ucHJldmlvdXNWYWx1ZSkge1xuICAgICAgICBpZiAoY2hhbmdlc1snZGlzYWJsZWQnXS5jdXJyZW50VmFsdWUgPT09IHRydWUpIHtcbiAgICAgICAgICB0aGlzLnpvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5uZ09uRGVzdHJveSgpO1xuXG4gICAgICAgICAgICB0aGlzLm5nQWZ0ZXJWaWV3SW5pdCgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKGNoYW5nZXNbJ2Rpc2FibGVkJ10uY3VycmVudFZhbHVlID09PSBmYWxzZSkge1xuICAgICAgICAgIHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLm5nT25EZXN0cm95KCk7XG5cbiAgICAgICAgICAgIHRoaXMubmdBZnRlclZpZXdJbml0KCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGVtaXQoZW1pdHRlcjogRXZlbnRFbWl0dGVyPGFueT4sIHZhbHVlOiBhbnkpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5wZXJmb3JtYW5jZSkge1xuICAgICAgZW1pdHRlci5lbWl0KHZhbHVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy56b25lLnJ1bigoKSA9PiBlbWl0dGVyLmVtaXQodmFsdWUpKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgc3dpcGVyKCk6IGFueSB7XG4gICAgcmV0dXJuIHRoaXMuaW5zdGFuY2U7XG4gIH1cblxuICBwdWJsaWMgaW5pdCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5pbnN0YW5jZSkge1xuICAgICAgdGhpcy56b25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgICAgdGhpcy5pbnN0YW5jZS5pbml0KCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgdXBkYXRlKCk6IHZvaWQge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuaW5zdGFuY2UpIHtcbiAgICAgICAgdGhpcy56b25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgICAgICB0aGlzLmluc3RhbmNlLnVwZGF0ZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LCAwKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRJbmRleChyZWFsPzogYm9vbGVhbik6IG51bWJlciB7XG4gICAgaWYgKCF0aGlzLmluc3RhbmNlKSB7XG4gICAgICByZXR1cm4gdGhpcy5pbml0aWFsSW5kZXggfHzCoDA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiByZWFsID8gdGhpcy5pbnN0YW5jZS5yZWFsSW5kZXggOiB0aGlzLmluc3RhbmNlLmFjdGl2ZUluZGV4O1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBzZXRJbmRleChpbmRleDogbnVtYmVyLCBzcGVlZD86IG51bWJlciwgc2lsZW50PzogYm9vbGVhbik6IHZvaWQge1xuICAgIGlmICghdGhpcy5pbnN0YW5jZSkge1xuICAgICAgdGhpcy5pbml0aWFsSW5kZXggPSBpbmRleDtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IHJlYWxJbmRleCA9IGluZGV4ICogdGhpcy5pbnN0YW5jZS5wYXJhbXMuc2xpZGVzUGVyR3JvdXA7XG5cbiAgICAgIGlmICh0aGlzLmluc3RhbmNlLnBhcmFtcy5sb29wKSB7XG4gICAgICAgIHJlYWxJbmRleCArPSB0aGlzLmluc3RhbmNlLmxvb3BlZFNsaWRlcztcbiAgICAgIH1cblxuICAgICAgdGhpcy56b25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgICAgdGhpcy5pbnN0YW5jZS5zbGlkZVRvKHJlYWxJbmRleCwgc3BlZWQsICFzaWxlbnQpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHByZXZTbGlkZShzcGVlZD86IG51bWJlciwgc2lsZW50PzogYm9vbGVhbik6IHZvaWQge1xuICAgIGlmICh0aGlzLmluc3RhbmNlKSB7XG4gICAgICB0aGlzLnpvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICB0aGlzLmluc3RhbmNlLnNsaWRlUHJldihzcGVlZCwgIXNpbGVudCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgbmV4dFNsaWRlKHNwZWVkPzogbnVtYmVyLCBzaWxlbnQ/OiBib29sZWFuKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaW5zdGFuY2UpIHtcbiAgICAgIHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgIHRoaXMuaW5zdGFuY2Uuc2xpZGVOZXh0KHNwZWVkLCAhc2lsZW50KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBzdG9wQXV0b3BsYXkocmVzZXQ/OiBib29sZWFuKTogdm9pZCB7XG4gICAgaWYgKHJlc2V0KSB7XG4gICAgICB0aGlzLnNldEluZGV4KDApO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmluc3RhbmNlICYmIHRoaXMuaW5zdGFuY2UuYXV0b3BsYXkpIHtcbiAgICAgIHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgIHRoaXMuaW5zdGFuY2UuYXV0b3BsYXkuc3RvcCgpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHN0YXJ0QXV0b3BsYXkocmVzZXQ/OiBib29sZWFuKTogdm9pZCB7XG4gICAgaWYgKHJlc2V0KSB7XG4gICAgICB0aGlzLnNldEluZGV4KDApO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmluc3RhbmNlICYmIHRoaXMuaW5zdGFuY2UuYXV0b3BsYXkpIHtcbiAgICAgIHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgIHRoaXMuaW5zdGFuY2UuYXV0b3BsYXkuc3RhcnQoKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufVxuIl19